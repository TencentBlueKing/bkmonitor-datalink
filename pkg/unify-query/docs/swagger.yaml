basePath: /
definitions:
  api.ErrResponse:
    properties:
      error:
        type: string
    type: object
  cmdb.Matcher:
    additionalProperties:
      type: string
    type: object
  cmdb.MatchersWithTimestamp:
    properties:
      items:
        items:
          $ref: '#/definitions/cmdb.Matcher'
        type: array
      timestamp:
        type: integer
    type: object
  cmdb.RelationMultiResourceRangeRequest:
    properties:
      query_list:
        items:
          properties:
            end_time:
              type: integer
            look_back_delta:
              type: string
            path_resource:
              items:
                type: string
              type: array
            source_expand_info:
              $ref: '#/definitions/cmdb.Matcher'
            source_info:
              $ref: '#/definitions/cmdb.Matcher'
            source_type:
              type: string
            start_time:
              type: integer
            step:
              type: string
            target_info_show:
              type: boolean
            target_type:
              type: string
          type: object
        type: array
    type: object
  cmdb.RelationMultiResourceRangeResponse:
    properties:
      data:
        items:
          $ref: '#/definitions/cmdb.RelationMultiResourceRangeResponseData'
        type: array
      trace_id:
        type: string
    type: object
  cmdb.RelationMultiResourceRangeResponseData:
    properties:
      code:
        type: integer
      message:
        type: string
      path:
        items:
          type: string
        type: array
      source_info:
        $ref: '#/definitions/cmdb.Matcher'
      source_type:
        type: string
      target_list:
        items:
          $ref: '#/definitions/cmdb.MatchersWithTimestamp'
        type: array
      target_type:
        type: string
    type: object
  cmdb.RelationMultiResourceRequest:
    properties:
      query_list:
        items:
          properties:
            look_back_delta:
              type: string
            path_resource:
              items:
                type: string
              type: array
            source_expand_info:
              $ref: '#/definitions/cmdb.Matcher'
            source_info:
              $ref: '#/definitions/cmdb.Matcher'
            source_type:
              type: string
            target_info_show:
              type: boolean
            target_type:
              type: string
            timestamp:
              type: integer
          type: object
        type: array
    type: object
  cmdb.RelationMultiResourceResponse:
    properties:
      data:
        items:
          $ref: '#/definitions/cmdb.RelationMultiResourceResponseData'
        type: array
      trace_id:
        type: string
    type: object
  cmdb.RelationMultiResourceResponseData:
    properties:
      code:
        type: integer
      message:
        type: string
      path:
        items:
          type: string
        type: array
      source_info:
        $ref: '#/definitions/cmdb.Matcher'
      source_type:
        type: string
      target_list:
        items:
          $ref: '#/definitions/cmdb.Matcher'
        type: array
      target_type:
        type: string
    type: object
  http.CheckItem:
    properties:
      error: {}
      json_data:
        type: string
      step_name:
        type: string
    type: object
  http.CheckResponse:
    properties:
      list:
        items:
          $ref: '#/definitions/http.CheckItem'
        type: array
    type: object
  http.ErrResponse:
    properties:
      error:
        type: string
      trace_id:
        type: string
    type: object
  http.PromData:
    properties:
      is_partial:
        type: boolean
      series:
        items:
          $ref: '#/definitions/http.TablesItem'
        type: array
      status:
        $ref: '#/definitions/metadata.Status'
      trace_id:
        type: string
    type: object
  http.SeriesData:
    properties:
      keys:
        items:
          type: string
        type: array
      measurement:
        type: string
      series:
        items:
          items:
            type: string
          type: array
        type: array
      trace_id:
        type: string
    type: object
  http.TablesItem:
    properties:
      columns:
        items:
          type: string
        type: array
      group_keys:
        items:
          type: string
        type: array
      group_values:
        items:
          type: string
        type: array
      metric_name:
        type: string
      name:
        type: string
      types:
        items:
          type: string
        type: array
      values:
        items:
          items: {}
          type: array
        type: array
    type: object
  http.TagValuesData:
    properties:
      trace_id:
        type: string
      values:
        additionalProperties:
          items:
            type: string
          type: array
        type: object
    type: object
  infos.Params:
    properties:
      conditions:
        $ref: '#/definitions/structured.Conditions'
      data_source:
        type: string
      end_time:
        type: string
      is_regexp:
        description: IsRegexp 指标是否使用正则查询
        example: false
        type: boolean
      keys:
        items:
          type: string
        type: array
      limit:
        type: integer
      metric_name:
        type: string
      slimit:
        type: integer
      start_time:
        type: string
      table_id:
        type: string
      timezone:
        example: Asia/Shanghai
        type: string
    type: object
  metadata.Status:
    properties:
      code:
        type: string
      message:
        type: string
    type: object
  structured.AggregateMethod:
    properties:
      dimensions:
        description: Dimensions 聚合维度
        example:
        - bk_target_ip
        - bk_target_cloud_id
        items:
          type: string
        type: array
      field:
        description: Field 聚合字段，默认为指标字段，指定则会进行覆盖
        example: field
        type: string
      is_sub_query:
        description: IsSubQuery 判断是否为子查询
        type: boolean
      method:
        description: Method 聚合方法
        example: mean
        type: string
      window:
        description: Window 聚合周期
        example: 60s
        type: string
      without:
        description: Without
        type: boolean
    type: object
  structured.ConditionField:
    properties:
      field_name:
        description: DimensionName 过滤字段
        example: bk_biz_id
        type: string
      is_prefix:
        description: IsPrefix 是否是前缀
        type: boolean
      is_suffix:
        description: IsSuffix 是否是后缀
        type: boolean
      is_wildcard:
        description: IsWildcard 是否是通配符
        type: boolean
      op:
        description: Operator 操作符，包含：eq,ne,erq,nreq,contains,ncontains
        example: contains
        type: string
      value:
        description: Value 查询值
        example:
        - "2"
        items:
          type: string
        type: array
    type: object
  structured.Conditions:
    properties:
      condition_list:
        description: ConditionList 组合条件，长度 = len(FieldList) - 1的数组，支持 and,or
        example:
        - and
        items:
          type: string
        type: array
      field_list:
        description: FieldList 查询条件
        items:
          $ref: '#/definitions/structured.ConditionField'
        type: array
    type: object
  structured.QueryPromQL:
    properties:
      bk_biz_ids:
        items:
          type: string
        type: array
      down_sample_range:
        description: DownSampleRange 降采样：大于Step才能生效，可以为空
        example: 5m
        type: string
      end:
        type: string
      instant:
        description: 瞬时数据
        type: boolean
      is_verify_dimensions:
        type: boolean
      limit:
        type: integer
      look_back_delta:
        description: LookBackDelta 偏移量
        type: string
      match:
        type: string
      max_source_resolution:
        type: string
      not_align_influxdb:
        description: 不与influxdb对齐
        type: boolean
      promql:
        type: string
      reference:
        type: boolean
      slimit:
        type: integer
      start:
        type: string
      step:
        type: string
      timezone:
        description: Timezone 时区
        example: Asia/Shanghai
        type: string
    type: object
  structured.QueryTs:
    type: object
  structured.TimeAggregation:
    properties:
      function:
        description: Function 时间聚合方法
        example: avg_over_time
        type: string
      is_sub_query:
        description: IsSubQuery 判断是否为子查询
        type: boolean
      node_index:
        description: NodeIndex 聚合函数的位置，用于还原 promql 的定位
        type: integer
      window:
        description: Window 聚合周期
        example: 60s
        type: string
    type: object
info:
  contact: {}
  description: bk unify-query swagger api
  title: bk-unify-query
  version: "1.0"
paths:
  /api/v1/relation/multi_resource:
    post:
      operationId: relation_multi_resource_query
      parameters:
      - default: 00-3967ac0f1648bf0216b27631730d7eb9-8e3c31d5109e78dd-01
        description: TraceID
        in: header
        name: traceparent
        type: string
      - default: bkcc__2
        description: 空间UID
        in: header
        name: X-Bk-Scope-Space-Uid
        type: string
      - description: json data
        in: body
        name: data
        required: true
        schema:
          $ref: '#/definitions/cmdb.RelationMultiResourceRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/cmdb.RelationMultiResourceResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrResponse'
      summary: query relation multi resource
  /api/v1/relation/multi_resource_range:
    post:
      operationId: relation_multi_resource_query_range
      parameters:
      - default: 00-3967ac0f1648bf0216b27631730d7eb9-8e3c31d5109e78dd-01
        description: TraceID
        in: header
        name: traceparent
        type: string
      - default: bkcc__2
        description: 空间UID
        in: header
        name: X-Bk-Scope-Space-Uid
        type: string
      - description: json data
        in: body
        name: data
        required: true
        schema:
          $ref: '#/definitions/cmdb.RelationMultiResourceRangeRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/cmdb.RelationMultiResourceRangeResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/api.ErrResponse'
      summary: query relation multi resource
  /check/query/ts:
    post:
      operationId: check_query_promql
      parameters:
      - default: 00-3967ac0f1648bf0216b27631730d7eb9-8e3c31d5109e78dd-01
        description: TraceID
        in: header
        name: traceparent
        type: string
      - default: bkcc__2
        description: 空间UID
        in: header
        name: X-Bk-Scope-Space-Uid
        type: string
      - default: ""
        description: 是否跳过空间验证
        in: header
        name: X-Bk-Scope-Skip-Space
        type: string
      - description: json data
        in: body
        name: data
        required: true
        schema:
          $ref: '#/definitions/structured.QueryPromQL'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/http.CheckResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/http.ErrResponse'
      summary: query promql monitor check by ts
  /query/promql:
    post:
      operationId: query_promql
      parameters:
      - default: 00-3967ac0f1648bf0216b27631730d7eb9-8e3c31d5109e78dd-01
        description: TraceID
        in: header
        name: traceparent
        type: string
      - default: username:goodman
        description: 来源
        in: header
        name: Bk-Query-Source
        type: string
      - default: bkcc__2
        description: 空间UID
        in: header
        name: X-Bk-Scope-Space-Uid
        type: string
      - default: ""
        description: 是否跳过空间验证
        in: header
        name: X-Bk-Scope-Skip-Space
        type: string
      - description: json data
        in: body
        name: data
        required: true
        schema:
          $ref: '#/definitions/structured.QueryPromQL'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/http.PromData'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/http.ErrResponse'
      summary: query monitor by promql
  /query/raw:
    post:
      operationId: query_raw
      parameters:
      - default: 00-3967ac0f1648bf0216b27631730d7eb9-8e3c31d5109e78dd-01
        description: TraceID
        in: header
        name: traceparent
        type: string
      - default: username:goodman
        description: 来源
        in: header
        name: Bk-Query-Source
        type: string
      - default: bkcc__2
        description: 空间UID
        in: header
        name: X-Bk-Scope-Space-Uid
        type: string
      - default: ""
        description: 是否跳过空间验证
        in: header
        name: X-Bk-Scope-Skip-Space
        type: string
      - description: json data
        in: body
        name: data
        required: true
        schema:
          $ref: '#/definitions/structured.QueryTs'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/http.PromData'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/http.ErrResponse'
      summary: query monitor by raw data
  /query/raw_with_scroll:
    post:
      operationId: query_raw_with_scroll
      parameters:
      - default: 00-3967ac0f1648bf0216b27631730d7eb9-8e3c31d5109e78dd-01
        description: TraceID
        in: header
        name: traceparent
        type: string
      - default: username:goodman
        description: 来源
        in: header
        name: Bk-Query-Source
        type: string
      - default: bkcc__2
        description: 空间UID
        in: header
        name: X-Bk-Scope-Space-Uid
        type: string
      - default: ""
        description: 是否跳过空间验证
        in: header
        name: X-Bk-Scope-Skip-Space
        type: string
      - description: json data
        in: body
        name: data
        required: true
        schema:
          $ref: '#/definitions/structured.QueryTs'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/http.PromData'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/http.ErrResponse'
      summary: query monitor by raw data with scroll
  /query/reference:
    post:
      operationId: query_reference
      parameters:
      - default: 00-3967ac0f1648bf0216b27631730d7eb9-8e3c31d5109e78dd-01
        description: TraceID
        in: header
        name: traceparent
        type: string
      - default: username:goodman
        description: 来源
        in: header
        name: Bk-Query-Source
        type: string
      - default: bkcc__2
        description: 空间UID
        in: header
        name: X-Bk-Scope-Space-Uid
        type: string
      - default: ""
        description: 是否跳过空间验证
        in: header
        name: X-Bk-Scope-Skip-Space
        type: string
      - description: json data
        in: body
        name: data
        required: true
        schema:
          $ref: '#/definitions/structured.QueryTs'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/http.PromData'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/http.ErrResponse'
      summary: query monitor by reference
  /query/ts:
    post:
      operationId: query_ts
      parameters:
      - default: 00-3967ac0f1648bf0216b27631730d7eb9-8e3c31d5109e78dd-01
        description: TraceID
        in: header
        name: traceparent
        type: string
      - default: username:goodman
        description: 来源
        in: header
        name: Bk-Query-Source
        type: string
      - default: bkcc__2
        description: 空间UID
        in: header
        name: X-Bk-Scope-Space-Uid
        type: string
      - default: ""
        description: 是否跳过空间验证
        in: header
        name: X-Bk-Scope-Skip-Space
        type: string
      - description: json data
        in: body
        name: data
        required: true
        schema:
          $ref: '#/definitions/structured.QueryTs'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/http.PromData'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/http.ErrResponse'
      summary: query monitor by ts
  /query/ts/exemplar:
    post:
      operationId: query_ts_exemplar
      parameters:
      - default: 00-3967ac0f1648bf0216b27631730d7eb9-8e3c31d5109e78dd-01
        description: TraceID
        in: header
        name: traceparent
        type: string
      - default: username:goodman
        description: 来源
        in: header
        name: Bk-Query-Source
        type: string
      - default: bkcc__2
        description: 空间UID
        in: header
        name: X-Bk-Scope-Space-Uid
        type: string
      - default: ""
        description: 是否跳过空间验证
        in: header
        name: X-Bk-Scope-Skip-Space
        type: string
      - description: json data
        in: body
        name: data
        required: true
        schema:
          $ref: '#/definitions/structured.QueryTs'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/http.PromData'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/http.ErrResponse'
      summary: query monitor by ts exemplar
  /query/ts/info/field_keys:
    post:
      operationId: info_field_keys
      parameters:
      - default: 00-3967ac0f1648bf0216b27631730d7eb9-8e3c31d5109e78dd-01
        description: TraceID
        in: header
        name: traceparent
        type: string
      - default: username:goodman
        description: 来源
        in: header
        name: Bk-Query-Source
        type: string
      - default: bkcc__2
        description: 空间UID
        in: header
        name: X-Bk-Scope-Space-Uid
        type: string
      - default: ""
        description: 是否跳过空间验证
        in: header
        name: X-Bk-Scope-Skip-Space
        type: string
      - description: json data
        in: body
        name: data
        required: true
        schema:
          $ref: '#/definitions/infos.Params'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              items:
                type: string
              type: array
            type: array
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/http.ErrResponse'
      summary: info field keys
  /query/ts/info/field_map:
    post:
      operationId: info_field_map
      parameters:
      - default: 00-3967ac0f1648bf0216b27631730d7eb9-8e3c31d5109e78dd-01
        description: TraceID
        in: header
        name: traceparent
        type: string
      - default: username:goodman
        description: 来源
        in: header
        name: Bk-Query-Source
        type: string
      - default: bkcc__2
        description: 空间UID
        in: header
        name: X-Bk-Scope-Space-Uid
        type: string
      - default: ""
        description: 是否跳过空间验证
        in: header
        name: X-Bk-Scope-Skip-Space
        type: string
      - description: json data
        in: body
        name: data
        required: true
        schema:
          $ref: '#/definitions/infos.Params'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/http.SeriesData'
            type: array
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/http.ErrResponse'
      summary: info field map
  /query/ts/info/series:
    post:
      operationId: info_series
      parameters:
      - default: 00-3967ac0f1648bf0216b27631730d7eb9-8e3c31d5109e78dd-01
        description: TraceID
        in: header
        name: traceparent
        type: string
      - default: username:goodman
        description: 来源
        in: header
        name: Bk-Query-Source
        type: string
      - default: bkcc__2
        description: 空间UID
        in: header
        name: X-Bk-Scope-Space-Uid
        type: string
      - default: ""
        description: 是否跳过空间验证
        in: header
        name: X-Bk-Scope-Skip-Space
        type: string
      - description: json data
        in: body
        name: data
        required: true
        schema:
          $ref: '#/definitions/infos.Params'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/http.SeriesData'
            type: array
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/http.ErrResponse'
      summary: info series
  /query/ts/info/tag_keys:
    post:
      operationId: info_tag_keys
      parameters:
      - default: 00-3967ac0f1648bf0216b27631730d7eb9-8e3c31d5109e78dd-01
        description: TraceID
        in: header
        name: traceparent
        type: string
      - default: username:goodman
        description: 来源
        in: header
        name: Bk-Query-Source
        type: string
      - default: bkcc__2
        description: 空间UID
        in: header
        name: X-Bk-Scope-Space-Uid
        type: string
      - default: ""
        description: 是否跳过空间验证
        in: header
        name: X-Bk-Scope-Skip-Space
        type: string
      - description: json data
        in: body
        name: data
        required: true
        schema:
          $ref: '#/definitions/infos.Params'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              items:
                type: string
              type: array
            type: array
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/http.ErrResponse'
      summary: info tag keys
  /query/ts/info/tag_values:
    post:
      operationId: info_tag_values
      parameters:
      - default: 00-3967ac0f1648bf0216b27631730d7eb9-8e3c31d5109e78dd-01
        description: TraceID
        in: header
        name: traceparent
        type: string
      - default: username:goodman
        description: 来源
        in: header
        name: Bk-Query-Source
        type: string
      - default: bkcc__2
        description: 空间UID
        in: header
        name: X-Bk-Scope-Space-Uid
        type: string
      - default: ""
        description: 是否跳过空间验证
        in: header
        name: X-Bk-Scope-Skip-Space
        type: string
      - description: json data
        in: body
        name: data
        required: true
        schema:
          $ref: '#/definitions/infos.Params'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/http.TagValuesData'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/http.ErrResponse'
      summary: info tag values
  /query/ts/label/{label_name}/values:
    get:
      operationId: info_label_values
      parameters:
      - default: 00-3967ac0f1648bf0216b27631730d7eb9-8e3c31d5109e78dd-01
        description: TraceID
        in: header
        name: traceparent
        type: string
      - default: username:goodman
        description: 来源
        in: header
        name: Bk-Query-Source
        type: string
      - default: bkcc__2
        description: 空间UID
        in: header
        name: X-Bk-Scope-Space-Uid
        type: string
      - default: ""
        description: 是否跳过空间验证
        in: header
        name: X-Bk-Scope-Skip-Space
        type: string
      - description: json data
        in: body
        name: data
        required: true
        schema:
          $ref: '#/definitions/infos.Params'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              items:
                type: string
              type: array
            type: array
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/http.ErrResponse'
      summary: info label values
  /query/ts/promql_to_struct:
    post:
      operationId: transform_promql_to_struct
      parameters:
      - default: 00-3967ac0f1648bf0216b27631730d7eb9-8e3c31d5109e78dd-01
        description: TraceID
        in: header
        name: traceparent
        type: string
      - default: username:goodman
        description: 来源
        in: header
        name: Bk-Query-Source
        type: string
      - default: bkcc__2
        description: 空间UID
        in: header
        name: X-Bk-Scope-Space-Uid
        type: string
      - description: json data
        in: body
        name: data
        required: true
        schema:
          $ref: '#/definitions/structured.QueryPromQL'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/structured.QueryTs'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/http.ErrResponse'
      summary: promql to struct
  /query/ts/struct_to_promql:
    post:
      operationId: transform_struct_to_promql
      parameters:
      - default: 00-3967ac0f1648bf0216b27631730d7eb9-8e3c31d5109e78dd-01
        description: TraceID
        in: header
        name: traceparent
        type: string
      - default: username:goodman
        description: 来源
        in: header
        name: Bk-Query-Source
        type: string
      - default: bkcc__2
        description: 空间UID
        in: header
        name: X-Bk-Scope-Space-Uid
        type: string
      - description: json data
        in: body
        name: data
        required: true
        schema:
          $ref: '#/definitions/structured.QueryTs'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/structured.QueryPromQL'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/http.ErrResponse'
      summary: query struct to promql
securityDefinitions:
  BasicAuth:
    type: basic
swagger: "2.0"
